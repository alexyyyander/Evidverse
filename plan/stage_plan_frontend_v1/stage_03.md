# Stage 03: 高级复杂编辑体验与打磨

## 目标
把 Editor 交互做“高级且复杂”，并将联动体验打磨到可长期迭代：复杂操作不乱、信息密度高但不崩、性能可控、可回归测试。

## 背景与痛点
- 高级编辑器的复杂度来自多面板 + 多对象 + 多选区的组合，需要明确规则（否则体验会“乱”）。
- 时间轴对齐不只是显示：需要缩放、吸附、标尺、快捷键、可视化提示等一整套系统。
- AI 生成结果需要与编辑器操作融合，避免“生成完不知道去哪了/怎么继续改”。

## 交付物
- 高信息密度但不混乱的 Editor：复杂面板、复杂对象、复杂交互可长期扩展。
- 时间轴具备“专业编辑器”的关键能力（缩放/吸附/标尺/轨道/裁剪/对齐可视化）。
- 关键路径可回归：选区联动、生成回填、保存与恢复、编辑操作不会轻易被改坏。

## Todo List
- [x] 时间轴缩放体系：水平缩放（基础版：Ctrl/Cmd + 鼠标滚轮）。
- [x] 时间轴滚动体系：基础版（Shift+滚轮水平滚动 + mini-map 快速定位 + 轨道折叠入口）。
- [x] 吸附系统（snap）：基础版（gridSnap + dragLine，可开关）。
- [x] 轨道系统：基础版（支持新增轨道 row + 行拖拽）。
- [x] 裁剪交互：基础版（时间轴 resize + Inspector 数值编辑）。
- [ ] 多选与编组（可选）：框选/多选片段，支持对齐、整体移动、复制粘贴。
- [x] 段落边界可视化：基础版（markers chips 跳转定位）。
- [ ] 一键对齐能力：按 Beat 建议时长对齐、按节拍对齐、按 marker 对齐（用户可撤销）。
- [ ] 联动“锁定模式”：选择 TimelineItem 后，其他面板默认跟随；用户可手动“解锁”以浏览但不改变选区。
- [x] Inspector 高级字段分组：基础版（Start/Duration 可编辑 + 关联 Beat/Asset 跳转）。
- [x] 预览播放器增强：基础版（loop + 步进 + 当前 Beat 标签）。
- [x] 历史与撤销重做：支持 Ctrl/Cmd+Z、Ctrl/Cmd+Shift+Z / Ctrl/Cmd+Y（覆盖 timeline/script/character 关键修改）。
- [x] 冲突与保护：生成回填提示“替换/并存/取消”，避免无声覆盖。
- [ ] 大项目性能：timeline 虚拟化渲染、重计算隔离、避免全局 store 频繁更新导致卡顿。
- [x] 错误边界与恢复：Editor 级 error boundary（提供重载入口）。
- [x] 回归用例集：最少覆盖 10 条关键路径（单测覆盖 store/校验/回填核心逻辑）。

## 验收标准
- Editor 在“剧本段落多 + 片段多”的情况下仍可稳定操作，且选择联动不乱。
- 用户点击任意片段后，能在一个页面内看到该片段“是什么（剧情）/谁参与（人物）/怎么生成（参数）/放哪（时间轴）”。
- 关键交互有可回归测试用例，避免未来迭代把联动系统改坏。
- 时间轴交互具备“专业感”：缩放/吸附/标尺/裁剪反馈清晰，且可预期。
