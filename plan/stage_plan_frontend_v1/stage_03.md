# Stage 03: 高级复杂编辑体验与打磨

## 目标
把 Editor 交互做“高级且复杂”，并将联动体验打磨到可长期迭代：复杂操作不乱、信息密度高但不崩、性能可控、可回归测试。

## 背景与痛点
- 高级编辑器的复杂度来自多面板 + 多对象 + 多选区的组合，需要明确规则（否则体验会“乱”）。
- 时间轴对齐不只是显示：需要缩放、吸附、标尺、快捷键、可视化提示等一整套系统。
- AI 生成结果需要与编辑器操作融合，避免“生成完不知道去哪了/怎么继续改”。

## 交付物
- 高信息密度但不混乱的 Editor：复杂面板、复杂对象、复杂交互可长期扩展。
- 时间轴具备“专业编辑器”的关键能力（缩放/吸附/标尺/轨道/裁剪/对齐可视化）。
- 关键路径可回归：选区联动、生成回填、保存与恢复、编辑操作不会轻易被改坏。

## Todo List
- [x] 时间轴缩放体系：水平缩放（基础版：Ctrl/Cmd + 鼠标滚轮）。
- [ ] 时间轴滚动体系：水平/垂直滚动、轨道折叠、mini-map（可选）快速定位。
- [ ] 吸附系统（snap）：吸附到刻度、段落边界 marker、相邻片段边缘；吸附提示线与阈值可配置。
- [ ] 轨道系统：视频轨/音频轨/字幕轨（或占位轨），支持添加/重命名/静音/锁定。
- [ ] 裁剪交互：拖拽片段左右边缘裁剪时长，实时显示新时长与对齐关系，支持取消/确认。
- [ ] 多选与编组（可选）：框选/多选片段，支持对齐、整体移动、复制粘贴。
- [ ] 段落边界可视化：按 Scene/Beat 自动生成 markers；markers 支持颜色/标题/跳转。
- [ ] 一键对齐能力：按 Beat 建议时长对齐、按节拍对齐、按 marker 对齐（用户可撤销）。
- [ ] 联动“锁定模式”：选择 TimelineItem 后，其他面板默认跟随；用户可手动“解锁”以浏览但不改变选区。
- [ ] Inspector 高级字段分组：基础（名称/时长/对齐）/生成（prompt/seed/风格）/转场/速度/滤镜/字幕/音量（逐步启用）。
- [ ] 预览播放器增强：播放范围（loop selected / loop scene）、逐帧/步进、显示当前 Beat/Clip 标签。
- [x] 历史与撤销重做：支持 Ctrl/Cmd+Z、Ctrl/Cmd+Shift+Z / Ctrl/Cmd+Y（覆盖 timeline/script/character 关键修改）。
- [ ] 冲突与保护：生成回填时若用户已手动编辑，提示“替换/并存/取消”，避免无声覆盖。
- [ ] 大项目性能：timeline 虚拟化渲染、重计算隔离、避免全局 store 频繁更新导致卡顿。
- [x] 错误边界与恢复：Editor 级 error boundary（提供重载入口）。
- [ ] 回归用例集：最少覆盖 10 条关键路径（选区联动、生成回填、裁剪吸附、撤销重做、刷新恢复等）。

## 验收标准
- Editor 在“剧本段落多 + 片段多”的情况下仍可稳定操作，且选择联动不乱。
- 用户点击任意片段后，能在一个页面内看到该片段“是什么（剧情）/谁参与（人物）/怎么生成（参数）/放哪（时间轴）”。
- 关键交互有可回归测试用例，避免未来迭代把联动系统改坏。
- 时间轴交互具备“专业感”：缩放/吸附/标尺/裁剪反馈清晰，且可预期。
